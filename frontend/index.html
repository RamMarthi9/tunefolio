<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>TuneFolio – Portfolio Overview</title>

    <!-- Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="assets/css/main.css" />
</head>

<body>
    <!-- =========================
         Header
    ========================== -->
    <header class="app-header">
        <div class="brand">
            <h1>TuneFolio</h1>
            <span class="subtitle">Portfolio Intelligence</span>
        </div>

        <div class="status">
            <span id="connection-status">● Connected to Zerodha</span>
            <span id="last-sync">Last sync: --</span>
            <button class="logout-btn" id="logoutBtn" title="Disconnect from Zerodha">Logout</button>
        </div>
    </header>

    <!-- =========================
         KPI Summary
    ========================== -->
    <section class="kpi-strip">
        <div class="kpi">
            <label>Current Value</label>
            <div id="kpi-current" class="value">—</div>
        </div>
        <div class="kpi">
            <label>Invested</label>
            <div id="kpi-invested" class="value">—</div>
        </div>
        <div class="kpi">
            <label>Unrealised P&amp;L</label>
            <div id="kpi-pnl" class="value">—</div>
        </div>
        <div class="kpi">
            <label>Realised P&amp;L (YTD)</label>
            <div id="kpi-realised-ytd" class="value">—</div>
        </div>
        <div class="kpi">
            <label id="kpi-realised-prev-label">Realised P&amp;L</label>
            <div id="kpi-realised-prev" class="value">—</div>
        </div>
        <div class="kpi">
            <label>Cash Available</label>
            <div id="kpi-cash" class="value">—</div>
        </div>
    </section>

    <!-- Clear Filters Banner (hidden by default) -->
    <div class="clear-filters-bar" id="clearFiltersBar">
        <span class="clear-filters-label" id="clearFiltersLabel">Filtered</span>
        <button class="clear-filters-btn" id="clearFiltersBtn">✕ Clear All Filters</button>
    </div>

    <!-- =========================
         Main Content
    ========================== -->
    <main class="content">

        <!-- Allocation (Pie Charts) -->
        <section class="card">
            <div class="card-header card-header--toggle">
                <div class="card-header-left">
                    <h2>Allocation</h2>
                </div>
                <button class="collapse-btn" aria-label="Toggle allocation">
                    <svg class="chevron" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M6 8l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="collapsible">
                <div class="allocation-section">
                    <div class="drilldown-header">
                        <div class="toggle-group" id="allocDimToggle">
                            <button class="toggle-btn active" data-dim="sector">Sector</button>
                            <button class="toggle-btn" data-dim="stock">Stock</button>
                        </div>
                    </div>
                    <div class="allocation-pair">
                        <div class="allocation-chart">
                            <h5>Current Value</h5>
                            <div class="chart-box chart-box--alloc">
                                <canvas id="allocChartCurrent"></canvas>
                            </div>
                        </div>
                        <div class="allocation-chart">
                            <h5>Invested Value</h5>
                            <div class="chart-box chart-box--alloc">
                                <canvas id="allocChartInvested"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analysis (Bar Charts) -->
        <section class="card">
            <div class="card-header card-header--toggle">
                <div class="card-header-left">
                    <h2>Analysis</h2>
                </div>
                <button class="collapse-btn" aria-label="Toggle analysis">
                    <svg class="chevron" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M6 8l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="collapsible">
                <div class="sector-grid">
                    <!-- P&L Bar with Sector/Stock toggle -->
                    <div class="sector-chart sector-chart--bar">
                        <div class="drilldown-header">
                            <h4>P&amp;L</h4>
                            <div class="toggle-group" id="pnlDimToggle">
                                <button class="toggle-btn active" data-dim="sector">Sector</button>
                                <button class="toggle-btn" data-dim="stock">Stock</button>
                            </div>
                        </div>
                        <div class="chart-box">
                            <canvas id="sectorPnlChart"></canvas>
                        </div>
                    </div>

                    <!-- Grouped Bar: Invested + Current Value -->
                    <div class="sector-chart sector-chart--drilldown">
                        <div class="drilldown-header">
                            <h4>Invested vs Current</h4>
                            <div class="toggle-group" id="valueDimToggle">
                                <button class="toggle-btn active" data-dim="sector">Sector</button>
                                <button class="toggle-btn" data-dim="stock">Stock</button>
                            </div>
                        </div>
                        <div class="chart-box chart-box--drilldown">
                            <canvas id="valueCompareChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Holdings -->
        <section class="card">
            <div class="card-header card-header--toggle" id="holdings-toggle">
                <div class="card-header-left">
                    <h2>Current Holdings</h2>
                    <span id="holdings-count"></span>
                </div>
                <button class="collapse-btn" aria-label="Toggle holdings table">
                    <svg class="chevron" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M6 8l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>

            <div class="collapsible" id="holdings-collapsible">
                <div class="table-wrapper">
                    <table id="holdings-table">
                        <thead>
                            <tr>
                                <th style="width:30px;"></th>
                                <th class="sortable" data-sort="symbol">Stock <span class="sort-icon"></span></th>
                                <th class="sortable" data-sort="sector">Sector <span class="sort-icon"></span></th>
                                <th>Qty</th>
                                <th>Avg Buy</th>
                                <th>LTP</th>
                                <th class="sortable" data-sort="invested_value">Invested <span class="sort-icon"></span></th>
                                <th class="sortable" data-sort="current_value">Value <span class="sort-icon"></span></th>
                                <th class="sortable" data-sort="pnl">P&amp;L <span class="sort-icon"></span></th>
                            </tr>
                            <tr class="filter-row">
                                <th></th>
                                <th>
                                    <div class="multi-select" id="stock-multiselect">
                                        <div class="multi-select-display" tabindex="0">
                                            <span class="multi-select-placeholder">All Stocks</span>
                                            <svg class="multi-select-arrow" width="12" height="12" viewBox="0 0 12 12">
                                                <path d="M3 5l3 3 3-3" stroke="currentColor" stroke-width="1.5" fill="none"/>
                                            </svg>
                                        </div>
                                        <div class="multi-select-dropdown"></div>
                                    </div>
                                </th>
                                <th>
                                    <div class="multi-select" id="sector-multiselect">
                                        <div class="multi-select-display" tabindex="0">
                                            <span class="multi-select-placeholder">All Sectors</span>
                                            <svg class="multi-select-arrow" width="12" height="12" viewBox="0 0 12 12">
                                                <path d="M3 5l3 3 3-3" stroke="currentColor" stroke-width="1.5" fill="none"/>
                                            </svg>
                                        </div>
                                        <div class="multi-select-dropdown"></div>
                                    </div>
                                </th>
                                <th colspan="6"></th>
                            </tr>
                        </thead>
                        <tbody id="holdings-body">
                            <tr>
                                <td colspan="9" class="loading">Loading holdings…</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Historical Holdings -->
        <section class="card">
            <div class="card-header card-header--toggle collapsed" id="historical-toggle">
                <div class="card-header-left">
                    <h2>Historical Holdings</h2>
                    <span id="historical-count"></span>
                </div>
                <button class="collapse-btn" aria-label="Toggle historical holdings table">
                    <svg class="chevron" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M6 8l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>

            <div class="collapsible collapsed" id="historical-collapsible">
                <div class="table-wrapper">
                    <table id="historical-table">
                        <thead>
                            <tr>
                                <th style="width:30px;"></th>
                                <th class="sortable" data-sort="symbol">Stock <span class="sort-icon"></span></th>
                                <th class="sortable" data-sort="sector">Sector <span class="sort-icon"></span></th>
                                <th>Qty</th>
                                <th>Avg Buy</th>
                                <th>Avg Sell</th>
                                <th class="sortable" data-sort="total_invested">Invested <span class="sort-icon"></span></th>
                                <th class="sortable" data-sort="total_proceeds">Proceeds <span class="sort-icon"></span></th>
                                <th class="sortable" data-sort="total_pnl">P&amp;L <span class="sort-icon"></span></th>
                            </tr>
                        </thead>
                        <tbody id="historical-body">
                            <tr>
                                <td colspan="9" class="loading">Loading historical holdings...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

    </main>

    <!-- =========================
         App JS (must load last)
    ========================== -->
    <script src="assets/js/app.js"></script>
</body>
</html>
