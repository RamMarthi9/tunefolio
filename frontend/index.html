<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>TuneFolio – Portfolio Overview</title>

    <!-- Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="assets/css/main.css" />
</head>

<body>
    <!-- =========================
         Header
    ========================== -->
    <header class="app-header">
        <div class="brand">
            <h1>TuneFolio</h1>
            <span class="subtitle">Portfolio Intelligence</span>
        </div>

        <div class="status">
            <span id="connection-status">● Connected to Zerodha</span>
            <span id="last-sync">Last sync: --</span>
        </div>
    </header>

    <!-- =========================
         KPI Summary
    ========================== -->
    <section class="kpi-strip">
        <div class="kpi">
            <label>Total Value</label>
            <div id="kpi-current" class="value">—</div>
        </div>
        <div class="kpi">
            <label>Invested</label>
            <div id="kpi-invested" class="value">—</div>
        </div>
        <div class="kpi">
            <label>Total P&amp;L</label>
            <div id="kpi-pnl" class="value">—</div>
        </div>
    </section>

    <!-- Clear Filters Banner (hidden by default) -->
    <div class="clear-filters-bar" id="clearFiltersBar">
        <span class="clear-filters-label" id="clearFiltersLabel">Filtered</span>
        <button class="clear-filters-btn" id="clearFiltersBtn">✕ Clear All Filters</button>
    </div>

    <!-- =========================
         Main Content
    ========================== -->
    <main class="content">

        <!-- Sectoral Analysis -->
        <section class="card">
            <div class="card-header card-header--toggle" id="sector-toggle">
                <div class="card-header-left">
                    <h2>Sectoral Analysis</h2>
                </div>
                <button class="collapse-btn" aria-label="Toggle sectoral analysis">
                    <svg class="chevron" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M6 8l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>

            <div class="collapsible" id="sector-collapsible">
                <div class="sector-grid">
                    <!-- Pie: Current Value -->
                    <div class="sector-chart">
                        <h4>By Current Value</h4>
                        <div class="chart-box">
                            <canvas id="sectorCurrentChart"></canvas>
                        </div>
                    </div>

                    <!-- Pie: Invested Value -->
                    <div class="sector-chart">
                        <h4>By Invested Value</h4>
                        <div class="chart-box">
                            <canvas id="sectorInvestedChart"></canvas>
                        </div>
                    </div>

                    <!-- P&L Bar -->
                    <div class="sector-chart sector-chart--bar">
                        <h4>P&amp;L by Sector</h4>
                        <div class="chart-box">
                            <canvas id="sectorPnlChart"></canvas>
                        </div>
                    </div>

                    <!-- Unified Drilldown Bar -->
                    <div class="sector-chart sector-chart--drilldown">
                        <div class="drilldown-header">
                            <h4>Breakdown</h4>
                            <div class="drilldown-toggles">
                                <div class="toggle-group" id="measureToggle">
                                    <button class="toggle-btn active" data-measure="invested">Invested</button>
                                    <button class="toggle-btn" data-measure="current">Current</button>
                                </div>
                                <div class="toggle-group" id="dimensionToggle">
                                    <button class="toggle-btn active" data-dim="sector">Sector</button>
                                    <button class="toggle-btn" data-dim="stock">Stock</button>
                                </div>
                            </div>
                        </div>
                        <div class="chart-box chart-box--drilldown">
                            <canvas id="unifiedDrilldownChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Holdings -->
        <section class="card">
            <div class="card-header card-header--toggle" id="holdings-toggle">
                <div class="card-header-left">
                    <h2>Holdings</h2>
                    <span id="holdings-count"></span>
                </div>
                <button class="collapse-btn" aria-label="Toggle holdings table">
                    <svg class="chevron" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M6 8l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>

            <div class="collapsible" id="holdings-collapsible">
                <div class="table-wrapper">
                    <table id="holdings-table">
                        <thead>
                            <tr>
                                <th>Stock</th>
                                <th class="sortable" data-sort="sector">Sector <span class="sort-icon"></span></th>
                                <th>Qty</th>
                                <th>Avg Buy</th>
                                <th>LTP</th>
                                <th class="sortable" data-sort="invested_value">Invested <span class="sort-icon"></span></th>
                                <th class="sortable" data-sort="current_value">Value <span class="sort-icon"></span></th>
                                <th class="sortable" data-sort="pnl">P&amp;L <span class="sort-icon"></span></th>
                            </tr>
                            <tr class="filter-row">
                                <th>
                                    <div class="multi-select" id="stock-multiselect">
                                        <div class="multi-select-display" tabindex="0">
                                            <span class="multi-select-placeholder">All Stocks</span>
                                            <svg class="multi-select-arrow" width="12" height="12" viewBox="0 0 12 12">
                                                <path d="M3 5l3 3 3-3" stroke="currentColor" stroke-width="1.5" fill="none"/>
                                            </svg>
                                        </div>
                                        <div class="multi-select-dropdown"></div>
                                    </div>
                                </th>
                                <th>
                                    <div class="multi-select" id="sector-multiselect">
                                        <div class="multi-select-display" tabindex="0">
                                            <span class="multi-select-placeholder">All Sectors</span>
                                            <svg class="multi-select-arrow" width="12" height="12" viewBox="0 0 12 12">
                                                <path d="M3 5l3 3 3-3" stroke="currentColor" stroke-width="1.5" fill="none"/>
                                            </svg>
                                        </div>
                                        <div class="multi-select-dropdown"></div>
                                    </div>
                                </th>
                                <th colspan="6"></th>
                            </tr>
                        </thead>
                        <tbody id="holdings-body">
                            <tr>
                                <td colspan="8" class="loading">Loading holdings…</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

    </main>

    <!-- =========================
         App JS (must load last)
    ========================== -->
    <script src="assets/js/app.js"></script>
</body>
</html>
